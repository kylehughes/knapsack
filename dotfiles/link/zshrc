#!/bin/zsh
# Minimal zshrc without oh-my-zsh

# History configuration
HISTFILE=~/.zsh_history
HISTSIZE=10000
SAVEHIST=10000
setopt APPEND_HISTORY
setopt INC_APPEND_HISTORY
setopt SHARE_HISTORY
setopt HIST_FIND_NO_DUPS
setopt HIST_IGNORE_DUPS
setopt HIST_REDUCE_BLANKS
setopt HIST_VERIFY

# Directory navigation
setopt AUTO_CD
setopt AUTO_PUSHD
setopt PUSHD_IGNORE_DUPS
setopt PUSHD_SILENT

# Completion
autoload -Uz compinit && compinit
zstyle ':completion:*' menu select
zstyle ':completion:*' matcher-list 'm:{a-z}={A-Z}'
zstyle ':completion:*' list-colors ''
setopt COMPLETE_IN_WORD
setopt ALWAYS_TO_END

# Key bindings
bindkey -e  # emacs mode
bindkey '^[[A' history-search-backward
bindkey '^[[B' history-search-forward

# Colors
autoload -U colors && colors

# Gengar theme colors
GENGAR_PURPLE='%F{135}'      # Medium purple
GENGAR_BRIGHT='%F{177}'      # Bright purple/pink
GENGAR_WHITE='%F{255}'       # Almost white for contrast

# Git branch with color
git_branch() {
    local branch=$(git symbolic-ref --short HEAD 2>/dev/null)
    if [[ -n $branch ]]; then
        echo "${GENGAR_BRIGHT}git:${GENGAR_WHITE}$branch%f "
    fi
}

setopt PROMPT_SUBST

# Gengar-themed prompt with better contrast
PROMPT='${GENGAR_PURPLE}%1~%f $(git_branch)${GENGAR_WHITE}%#%f '

# Essential git aliases
alias g='git'
alias ga='git add'
alias gaa='git add --all'
alias gb='git branch'
alias gc='git commit -v'
alias gca='git commit -v -a'
alias gcam='git commit -a -m'
alias gco='git checkout'
alias gd='git diff'
alias gf='git fetch'
alias gl='git pull'
alias glog='git log --oneline --decorate --graph'
alias gp='git push'
alias gr='git remote'
alias gst='git status'

# Other useful aliases
alias ll='ls -la'
alias la='ls -A'
alias l='ls -CF'

# Environment variables
export EDITOR='vim'
export LANG=en_US.UTF-8

# PATH management with deduplication
dedup_path() {
    typeset -U path
    path=($path)
}

# Homebrew (Apple Silicon)
if [[ -f /opt/homebrew/bin/brew ]]; then
    eval "$(/opt/homebrew/bin/brew shellenv)"
fi

# rbenv
if command -v rbenv &> /dev/null; then
    eval "$(rbenv init -)"
fi

# pyenv
if command -v pyenv &> /dev/null; then
    export PYENV_ROOT="$HOME/.pyenv"
    export PATH="$PYENV_ROOT/bin:$PATH"
    eval "$(pyenv init -)"
fi

# Add custom paths
export PATH="$HOME/bin:$PATH"

# Clean up PATH
dedup_path


# Source local profile if it exists
[[ -f ~/.profile ]] && source ~/.profile

# Disable git globbing (for commands like git add *)
alias git='noglob git'